import java.util.LinkedList;

public class Album {
    private String name;
    private String condition;
    private PhotoManager manager;
    private int NbComps;

    // Constructor
    public Album(String name, String condition, PhotoManager manager) {
        this.name = name;
        this.condition = condition;
        this.manager = manager;
        NbComps = 0;
    }

    // Return the name of the album
    public String getName() {
        return name;
    }

    // Return the condition associated with the album
    public String getCondition() {
        return condition;
    }

    // Return the manager
    public PhotoManager getManager() {
        return manager;
    }

    // Return all photos that satisfy the album condition
    public LinkedList<Photo> getPhotos() {
        LinkedList<Photo> filteredPhotos = new LinkedList<Photo>();
        LinkedList<Photo> allPhotos = manager.getPhotos();

        // Copy all photos into filteredPhotos
        if (!allPhotos.empty()) {
            allPhotos.findFirst();
            while (!allPhotos.last()) {
                Photo p = allPhotos.retrieve();
                filteredPhotos.insert(new Photo(p.getPath(), p.getTags()));
                allPhotos.findNext();
            }

            // Add the last photo
            Photo lastPhoto = allPhotos.retrieve();
            filteredPhotos.insert(new Photo(lastPhoto.getPath(), lastPhoto.getTags()));
        }

        NbComps = 0;

        // Apply filtering if condition is not empty
        if (!condition.equals("")) {
            String[] requiredTags = condition.split(" AND ");

            filteredPhotos.findFirst();
            while (!filteredPhotos.last()) {
                Photo currentPhoto = filteredPhotos.retrieve();
                if (!areTagsAvailable(currentPhoto.allTags, requiredTags)) {
                    filteredPhotos.remove();
                } else {
                    filteredPhotos.findNext();
                }
            }

            // Check the last photo
            Photo lastPhoto = filteredPhotos.retrieve();
            if (!areTagsAvailable(lastPhoto.allTags, requiredTags)) {
                filteredPhotos.remove();
            } else {
                filteredPhotos.findNext();
            }
        }

        return filteredPhotos;
    }

    // Return the number of tag comparisons
    public int getNbComps() {
        return NbComps;
    }

    // Helper method to check if all required tags are in the photo
    private boolean areTagsAvailable(LinkedList<String> allTags, String[] requiredTags) {
        if (allTags.empty()) return false;

        for (int i = 0; i < requiredTags.length; i++) {
            boolean tagFound = false;

            allTags.findFirst();
            while (!allTags.last()) {
                NbComps++;
                if (allTags.retrieve().equalsIgnoreCase(requiredTags[i])) {
                    tagFound = true;
                    break;
                }
                allTags.findNext();
            }

            if (!tagFound) {
                NbComps++;
                if (allTags.retrieve().equalsIgnoreCase(requiredTags[i])) {
                    tagFound = true;
                }
            }

            if (!tagFound) {
                return false;
            }
        }

        return true;
    }
}
